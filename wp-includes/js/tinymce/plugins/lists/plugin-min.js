!function(){var e=function(){"use strict";function e(){}var t=tinymce.util.Tools.resolve("tinymce.PluginManager"),n=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),o=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),i=tinymce.util.Tools.resolve("tinymce.util.VK"),r=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager"),s=tinymce.util.Tools.resolve("tinymce.util.Tools"),a=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),d=function(e){return e&&3===e.nodeType},l=function(e){return e&&/^(OL|UL|DL)$/.test(e.nodeName)},c=function(e){return e&&/^(LI|DT|DD)$/.test(e.nodeName)},u=function(e){return e&&/^(TH|TD)$/.test(e.nodeName)},f=function(e){return e&&"BR"===e.nodeName},m=function(e){return e.parentNode.firstChild===e},g=function(e){return e.parentNode.lastChild===e},p=function(e,t){return t&&!!e.schema.getTextBlockElements()[t.nodeName]},v=function(e,t){return e&&e.nodeName in t},h=function(e,t){return!!f(t)&&!(!e.isBlock(t.nextSibling)||f(t.previousSibling))},N=function(e,t,n){var o=e.isEmpty(t);return!(n&&e.select("span[data-mce-type=bookmark]",t).length>0)&&o},C=function(e,t){return e.isChildOf(t,e.getRoot())},L={isTextNode:d,isListNode:l,isListItemNode:c,isTableCellNode:u,isBr:f,isFirstChild:m,isLastChild:g,isTextBlock:p,isBlock:v,isBogusBr:h,isEmpty:N,isChildOfBody:C},y=function(e,t){var o=n.getNode(e,t);if(L.isListItemNode(e)&&L.isTextNode(o)){return{container:o,offset:t>=e.childNodes.length?o.data.length:0}}return{container:e,offset:t}},k=function(e){var t=e.cloneRange(),n=y(e.startContainer,e.startOffset);t.setStart(n.container,n.offset);var o=y(e.endContainer,e.endOffset);return t.setEnd(o.container,o.offset),t},B={getNormalizedEndPoint:y,normalizeRange:k},S=a.DOM,b=function(e){var t={},n=function(n){var o,i,r;i=e[n?"startContainer":"endContainer"],r=e[n?"startOffset":"endOffset"],1===i.nodeType&&(o=S.create("span",{"data-mce-type":"bookmark"}),i.hasChildNodes()?(r=Math.min(r,i.childNodes.length-1),n?i.insertBefore(o,i.childNodes[r]):S.insertAfter(o,i.childNodes[r])):i.appendChild(o),i=o,r=0),t[n?"startContainer":"endContainer"]=i,t[n?"startOffset":"endOffset"]=r};return n(!0),e.collapsed||n(),t},T=function(e){function t(t){var n,o,i,r=function(e){for(var t=e.parentNode.firstChild,n=0;t;){if(t===e)return n;1===t.nodeType&&"bookmark"===t.getAttribute("data-mce-type")||n++,t=t.nextSibling}return-1};n=i=e[t?"startContainer":"endContainer"],o=e[t?"startOffset":"endOffset"],n&&(1===n.nodeType&&(o=r(n),n=n.parentNode,S.remove(i),!n.hasChildNodes()&&S.isBlock(n)&&n.appendChild(S.create("br"))),e[t?"startContainer":"endContainer"]=n,e[t?"startOffset":"endOffset"]=o)}t(!0),t();var n=S.createRng();return n.setStart(e.startContainer,e.startOffset),e.endContainer&&n.setEnd(e.endContainer,e.endOffset),B.normalizeRange(n)},D={createBookmark:b,resolveBookmark:T},E=a.DOM,I=function(e,t){var n,o=t.parentNode;"LI"===o.nodeName&&o.firstChild===t&&(n=o.previousSibling,n&&"LI"===n.nodeName?(n.appendChild(t),L.isEmpty(e,o)&&E.remove(o)):E.setStyle(o,"listStyleType","none")),L.isListNode(o)&&(n=o.previousSibling)&&"LI"===n.nodeName&&n.appendChild(t)},O=function(e,t){s.each(s.grep(e.select("ol,ul",t)),function(t){I(e,t)})},R={normalizeList:I,normalizeLists:O},x=tinymce.util.Tools.resolve("tinymce.dom.DomQuery"),A=function(e){var t=e.selection.getStart(!0);return e.dom.getParent(t,"OL,UL,DL",z(e,t))},P=function(e,t){return e&&1===t.length&&t[0]===e},_=function(e){return s.grep(e.querySelectorAll("ol,ul,dl"),function(e){return L.isListNode(e)})},M=function(e){var t=A(e),n=e.selection.getSelectedBlocks();return P(t,n)?_(t):s.grep(n,function(e){return L.isListNode(e)&&t!==e})},w=function(e,t){var n=s.map(t,function(t){var n=e.dom.getParent(t,"li,dd,dt",z(e,t));return n||t});return x.unique(n)},U=function(e){var t=e.selection.getSelectedBlocks();return s.grep(w(e,t),function(e){return L.isListItemNode(e)})},z=function(e,t){var n=e.dom.getParents(t,"TD,TH");return n.length>0?n[0]:e.getBody()},H={getParentList:A,getSelectedSubLists:M,getSelectedListItems:U,getClosestListRootElm:z},F=tinymce.util.Tools.resolve("tinymce.Env"),K=a.DOM,Q=function(e,t,n){var o,i,r=K.createFragment(),s,a=e.schema.getBlockElements();if(e.settings.forced_root_block&&(n=n||e.settings.forced_root_block),n&&(i=K.create(n),i.tagName===e.settings.forced_root_block&&K.setAttribs(i,e.settings.forced_root_block_attrs),L.isBlock(t.firstChild,a)||r.appendChild(i)),t)for(;o=t.firstChild;){var d=o.nodeName;s||"SPAN"===d&&"bookmark"===o.getAttribute("data-mce-type")||(s=!0),L.isBlock(o,a)?(r.appendChild(o),i=null):n?(i||(i=K.create(n),r.appendChild(i)),i.appendChild(o)):r.appendChild(o)}return e.settings.forced_root_block?s||F.ie&&!(F.ie>10)||i.appendChild(K.create("br",{"data-mce-bogus":"1"})):r.appendChild(K.create("br")),r},W={createNewTextBlock:Q},j=a.DOM,q=function(e,t,n,o){var i,r,a,d,l=function(e){s.each(a,function(t){e.parentNode.insertBefore(t,n.parentNode)}),j.remove(e)};for(a=j.select('span[data-mce-type="bookmark"]',t),o=o||W.createNewTextBlock(e,n),i=j.createRng(),i.setStartAfter(n),i.setEndAfter(t),r=i.extractContents(),d=r.firstChild;d;d=d.firstChild)if("LI"===d.nodeName&&e.dom.isEmpty(d)){j.remove(d);break}e.dom.isEmpty(r)||j.insertAfter(r,t),j.insertAfter(o,t),L.isEmpty(e.dom,n.parentNode)&&l(n.parentNode),j.remove(n),L.isEmpty(e.dom,t)&&j.remove(t)},V={splitList:q},G=a.DOM,J=function(e,t){L.isEmpty(e,t)&&G.remove(t)},X=function(e,t){var n=t.parentNode,o,i;return n?(o=n.parentNode,n===e.getBody()||("DD"===t.nodeName?(G.rename(t,"DT"),!0):L.isFirstChild(t)&&L.isLastChild(t)?("LI"===o.nodeName?(G.insertAfter(t,o),J(e.dom,o),G.remove(n)):L.isListNode(o)?G.remove(n,!0):(o.insertBefore(W.createNewTextBlock(e,t),n),G.remove(n)),!0):L.isFirstChild(t)?("LI"===o.nodeName?(G.insertAfter(t,o),t.appendChild(n),J(e.dom,o)):L.isListNode(o)?o.insertBefore(t,n):(o.insertBefore(W.createNewTextBlock(e,t),n),G.remove(t)),!0):L.isLastChild(t)?("LI"===o.nodeName?G.insertAfter(t,o):L.isListNode(o)?G.insertAfter(t,n):(G.insertAfter(W.createNewTextBlock(e,t),n),G.remove(t)),!0):("LI"===o.nodeName?(n=o,i=W.createNewTextBlock(e,t,"LI")):i=L.isListNode(o)?W.createNewTextBlock(e,t,"LI"):W.createNewTextBlock(e,t),V.splitList(e,n,t,i),R.normalizeLists(e.dom,n.parentNode),!0))):(J(e.dom,t),!0)},Y=function(e){var t=H.getSelectedListItems(e);if(t.length){var n=D.createBookmark(e.selection.getRng()),o=void 0,i=void 0,r=H.getClosestListRootElm(e,e.selection.getStart(!0));for(o=t.length;o--;)for(var s=t[o].parentNode;s&&s!==r;){for(i=t.length;i--;)if(t[i]===s){t.splice(o,1);break}s=s.parentNode}for(o=0;o<t.length&&(X(e,t[o])||0!==o);o++);return e.selection.setRng(D.resolveBookmark(n)),e.nodeChanged(),!0}},Z={outdent:X,outdentSelection:Y},ee=function(e,t,n){var o=n["list-style-type"]?n["list-style-type"]:null;e.setStyle(t,"list-style-type",o)},te=function(e,t){s.each(t,function(t,n){e.setAttribute(n,t)})},ne=function(e,t,n){te(t,n["list-attributes"]),s.each(e.select("li",t),function(e){te(e,n["list-item-attributes"])})},oe=function(e,t,n){ee(e,t,n),ne(e,t,n)},ie=function(e,t,n){s.each(n,function(n){return e.setStyle(t,(o={},o[n]="",o));var o})},re=function(e,t,n,o){var i,r;for(i=t[n?"startContainer":"endContainer"],r=t[n?"startOffset":"endOffset"],1===i.nodeType&&(i=i.childNodes[Math.min(r,i.childNodes.length-1)]||i),!n&&L.isBr(i.nextSibling)&&(i=i.nextSibling);i.parentNode!==o;){if(L.isTextBlock(e,i))return i;if(/^(TD|TH)$/.test(i.parentNode.nodeName))return i;i=i.parentNode}return i},se=function(e,t,n){for(var o=[],i=e.dom,a=re(e,t,!0,n),d=re(e,t,!1,n),l,c=[],u=a;u&&(c.push(u),u!==d);u=u.nextSibling);return s.each(c,function(t){if(L.isTextBlock(e,t))return o.push(t),void(l=null);if(i.isBlock(t)||L.isBr(t))return L.isBr(t)&&i.remove(t),void(l=null);var s=t.nextSibling;if(r.isBookmarkNode(t)&&(L.isTextBlock(e,s)||!s&&t.parentNode===n))return void(l=null);l||(l=i.create("p"),t.parentNode.insertBefore(l,t),o.push(l)),l.appendChild(t)}),o},ae=function(e,t,n){var o=e.getStyle(t,"list-style-type"),i=n?n["list-style-type"]:"";return i=null===i?"":i,o===i},de=function(e,t,n){void 0===n&&(n={});var o=e.selection.getRng(!0),i,r="LI",a=H.getClosestListRootElm(e,e.selection.getStart(!0)),d=e.dom;"false"!==d.getContentEditable(e.selection.getNode())&&(t=t.toUpperCase(),"DL"===t&&(r="DT"),i=D.createBookmark(o),s.each(se(e,o,a),function(o){var i,s;s=o.previousSibling,s&&L.isListNode(s)&&s.nodeName===t&&ae(d,s,n)?(i=s,o=d.rename(o,r),s.appendChild(o)):(i=d.create(t),o.parentNode.insertBefore(i,o),i.appendChild(o),o=d.rename(o,r)),ie(d,o,["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"]),oe(d,i,n),ge(e.dom,i)}),e.selection.setRng(D.resolveBookmark(i)))},le=function(e){var t=D.createBookmark(e.selection.getRng(!0)),n=H.getClosestListRootElm(e,e.selection.getStart(!0)),o=H.getSelectedListItems(e),i=s.grep(o,function(t){return e.dom.isEmpty(t)});o=s.grep(o,function(t){return!e.dom.isEmpty(t)}),s.each(i,function(t){if(L.isEmpty(e.dom,t))return void Z.outdent(e,t)}),s.each(o,function(t){var o,i;if(t.parentNode!==e.getBody()){for(o=t;o&&o!==n;o=o.parentNode)L.isListNode(o)&&(i=o);V.splitList(e,i,t),R.normalizeLists(e.dom,i.parentNode)}}),e.selection.setRng(D.resolveBookmark(t))},ce=function(e,t){return e&&t&&L.isListNode(e)&&e.nodeName===t.nodeName},ue=function(e,t,n){return e.getStyle(t,"list-style-type",!0)===e.getStyle(n,"list-style-type",!0)},fe=function(e,t){return e.className===t.className},me=function(e,t,n){return ce(t,n)&&ue(e,t,n)&&fe(t,n)},ge=function(e,t){var n,o;if(n=t.nextSibling,me(e,t,n)){for(;o=n.firstChild;)t.appendChild(o);e.remove(n)}if(n=t.previousSibling,me(e,t,n)){for(;o=n.lastChild;)t.insertBefore(o,t.firstChild);e.remove(n)}},pe=function(e,t,n,o){if(t.nodeName!==n){var i=e.rename(t,n);oe(e,i,o)}else oe(e,t,o)},ve=function(e,t,n,o,i){if(t.nodeName!==o||he(i)){var r=D.createBookmark(e.selection.getRng(!0));s.each([t].concat(n),function(t){pe(e.dom,t,o,i)}),e.selection.setRng(D.resolveBookmark(r))}else le(e)},he=function(e){return"list-style-type"in e},Ne=function(e,t,n,o){if(t!==e.getBody())if(t)if(t.nodeName!==n||he(o)){var i=D.createBookmark(e.selection.getRng(!0));oe(e.dom,t,o),ge(e.dom,e.dom.rename(t,n)),e.selection.setRng(D.resolveBookmark(i))}else le(e);else de(e,n,o)},Ce=function(e,t,n){var o=H.getParentList(e),i=H.getSelectedSubLists(e);n=n||{},o&&i.length>0?ve(e,o,i,t,n):Ne(e,o,t,n)},Le={toggleList:Ce,removeList:le,mergeWithAdjacentLists:ge},ye=function(e,t,i,r){var s=t.startContainer,a=t.startOffset,d,l;if(3===s.nodeType&&(i?a<s.data.length:a>0))return s;for(d=e.schema.getNonEmptyElements(),1===s.nodeType&&(s=n.getNode(s,a)),l=new o(s,r),i&&L.isBogusBr(e.dom,s)&&l.next();s=l[i?"next":"prev2"]();){if("LI"===s.nodeName&&!s.hasChildNodes())return s;if(d[s.nodeName])return s;if(3===s.nodeType&&s.data.length>0)return s}},ke=function(e,t){var n=t.childNodes;return 1===n.length&&!L.isListNode(n[0])&&e.isBlock(n[0])},Be=function(e,t){ke(e,t)&&e.remove(t.firstChild,!0)},Se=function(e,t,n){var o,i;if(i=ke(e,n)?n.firstChild:n,Be(e,t),!L.isEmpty(e,t,!0))for(;o=t.firstChild;)i.appendChild(o)},be=function(e,t,n){var o,i,r=t.parentNode;L.isChildOfBody(e,t)&&L.isChildOfBody(e,n)&&(L.isListNode(n.lastChild)&&(i=n.lastChild),r===n.lastChild&&L.isBr(r.previousSibling)&&e.remove(r.previousSibling),o=n.lastChild,o&&L.isBr(o)&&t.hasChildNodes()&&e.remove(o),L.isEmpty(e,n,!0)&&e.$(n).empty(),Se(e,t,n),i&&n.appendChild(i),e.remove(t),L.isEmpty(e,r)&&r!==e.getRoot()&&e.remove(r))},Te=function(e,t,n){e.dom.$(n).empty(),be(e.dom,t,n),e.selection.setCursorLocation(n)},De=function(e,t,n,o){var i=e.dom;if(i.isEmpty(o))Te(e,n,o);else{var r=D.createBookmark(t);be(i,n,o),e.selection.setRng(D.resolveBookmark(r))}},Ee=function(e,t,n,o){var i=D.createBookmark(t);be(e.dom,n,o);var r=D.resolveBookmark(i);e.selection.setRng(r)},Ie=function(e,t){var n=e.dom,o=e.selection,i=o.getStart(),r=H.getClosestListRootElm(e,i),s=n.getParent(o.getStart(),"LI",r),a,d,l;if(s){if((a=s.parentNode)===e.getBody()&&L.isEmpty(n,a))return!0;if(d=B.normalizeRange(o.getRng(!0)),(l=n.getParent(ye(e,d,t,r),"LI",r))&&l!==s)return t?De(e,d,l,s):Ee(e,d,s,l),!0;if(!l&&!t&&Le.removeList(e))return!0}return!1},Oe=function(e,t,n){var o=e.getParent(t.parentNode,e.isBlock,n);e.remove(t),o&&e.isEmpty(o)&&e.remove(o)},Re=function(e,t){var n=e.dom,o=e.selection.getStart(),i=H.getClosestListRootElm(e,o),r=n.getParent(o,n.isBlock,i);if(r&&n.isEmpty(r)){var s=B.normalizeRange(e.selection.getRng(!0)),a=n.getParent(ye(e,s,t,i),"LI",i);if(a)return e.undoManager.transact(function(){Oe(n,r,i),Le.mergeWithAdjacentLists(n,a.parentNode),e.selection.select(a,!0),e.selection.collapse(t)}),!0}return!1},xe=function(e,t){return Ie(e,t)||Re(e,t)},Ae=function(e){var t=e.selection.getStart(),n=H.getClosestListRootElm(e,t);return!!(e.dom.getParent(t,"LI,DT,DD",n)||H.getSelectedListItems(e).length>0)&&(e.undoManager.transact(function(){e.execCommand("Delete"),R.normalizeLists(e.dom,e.getBody())}),!0)},Pe=function(e,t){return e.selection.isCollapsed()?xe(e,t):Ae(e)},_e=function(e){e.on("keydown",function(t){t.keyCode===i.BACKSPACE?Pe(e,!1)&&t.preventDefault():t.keyCode===i.DELETE&&Pe(e,!0)&&t.preventDefault()})},Me={setup:_e,backspaceDelete:Pe},we=function(e){return{backspaceDelete:function(t){Me.backspaceDelete(e,t)}}},Ue={get:we},ze=a.DOM,He=function(e,t){var n;if(L.isListNode(e)){for(;n=e.firstChild;)t.appendChild(n);ze.remove(e)}},$e=function(e){var t,n,o;return"DT"===e.nodeName?(ze.rename(e,"DD"),!0):(t=e.previousSibling)&&L.isListNode(t)?(t.appendChild(e),!0):t&&"LI"===t.nodeName&&L.isListNode(t.lastChild)?(t.lastChild.appendChild(e),He(e.lastChild,t.lastChild),!0):(t=e.nextSibling)&&L.isListNode(t)?(t.insertBefore(e,t.firstChild),!0):!(!(t=e.previousSibling)||"LI"!==t.nodeName)&&(n=ze.create(e.parentNode.nodeName),o=ze.getStyle(e.parentNode,"listStyleType"),o&&ze.setStyle(n,"listStyleType",o),t.appendChild(n),n.appendChild(e),He(e.lastChild,n),!0)},Fe=function(e){var t=H.getSelectedListItems(e);if(t.length){for(var n=D.createBookmark(e.selection.getRng(!0)),o=0;o<t.length&&($e(t[o])||0!==o);o++);return e.selection.setRng(D.resolveBookmark(n)),e.nodeChanged(),!0}},Ke={indentSelection:Fe},Qe=function(e,t){return function(){var n=e.dom.getParent(e.selection.getStart(),"UL,OL,DL");return n&&n.nodeName===t}},We=function(e){e.on("BeforeExecCommand",function(t){var n=t.command.toLowerCase(),o;if("indent"===n?Ke.indentSelection(e)&&(o=!0):"outdent"===n&&Z.outdentSelection(e)&&(o=!0),o)return e.fire("ExecCommand",{command:t.command}),t.preventDefault(),!0}),e.addCommand("InsertUnorderedList",function(t,n){Le.toggleList(e,"UL",n)}),e.addCommand("InsertOrderedList",function(t,n){Le.toggleList(e,"OL",n)}),e.addCommand("InsertDefinitionList",function(t,n){Le.toggleList(e,"DL",n)}),e.addQueryStateHandler("InsertUnorderedList",Qe(e,"UL")),e.addQueryStateHandler("InsertOrderedList",Qe(e,"OL")),e.addQueryStateHandler("InsertDefinitionList",Qe(e,"DL"))},je={register:We},qe=function(e){return e.getParam("lists_indent_on_tab",!0)},Ve={shouldIndentOnTab:qe},Ge=function(e){e.on("keydown",function(t){t.keyCode!==i.TAB||i.metaKeyPressed(t)||e.dom.getParent(e.selection.getStart(),"LI,DT,DD")&&(t.preventDefault(),t.shiftKey?Z.outdentSelection(e):Ke.indentSelection(e))})},Je=function(e){Ve.shouldIndentOnTab(e)&&Ge(e),Me.setup(e)},Xe={setup:Je},Ye=function(e,t){for(var n=0;n<e.length;n++){if(t(e[n]))return n}return-1},Ze=function(e,t){return function(n){var o=n.control;e.on("NodeChange",function(e){var n=Ye(e.parents,L.isTableCellNode),i=-1!==n?e.parents.slice(0,n):e.parents,r=s.grep(i,L.isListNode);o.active(r.length>0&&r[0].nodeName===t)})}},et=function(e){return function(t){var n=t.control;e.on("nodechange",function(){var t=H.getSelectedListItems(e),o=t.length>0&&L.isFirstChild(t[0]);n.disabled(o)})}},tt=function(e){(function(e,t){var n=e.settings.plugins?e.settings.plugins:"";return-1!==s.inArray(n.split(/[ ,]/),t)})(e,"advlist")||(e.addButton("numlist",{active:!1,title:"Numbered list",cmd:"InsertOrderedList",onPostRender:Ze(e,"OL")}),e.addButton("bullist",{active:!1,title:"Bullet list",cmd:"InsertUnorderedList",onPostRender:Ze(e,"UL")})),e.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:et(e)})},nt={register:tt};return t.add("lists",function(e){return Xe.setup(e),nt.register(e),je.register(e),Ue.get(e)}),e}()}();